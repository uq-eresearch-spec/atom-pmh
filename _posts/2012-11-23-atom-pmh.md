---
layout: default
title: Atom Feed Protocol for Metadata Harvesting 1.0 draft 2012-11-23
---
Atom Feed Protocol for Metadata Harvesting 1.0
==============================================

**Draft 2012-11-23**

This version
: <{{site.url}}{{page.url}}>

Latest version
: <{{site.url}}>

{% if page.previous.url %}
Previous version
: <{{site.url}}{{page.previous.url}}>
{% endif %}

Editors
: Hoylen Sue [h.sue@uq.edu.au](mailto:hoylen@hoylen.com)  
  Tim Dettrick <t.dettrick@uq.edu.au>

Copyright &copy; 2012-2013, The University of Queensland (ITEE
eResearch Group).

This work by [The University of Queensland (ITEE eResearch
Group)](http://www.itee.uq.edu.au/eresearch/) is licensed under a
[Creative Commons Attribution 3.0 Australia
License](http://creativecommons.org/licenses/by/3.0/au/).

Abstract
--------

The Atom Feed Protocol for Metadata Harvesting (Atom-PMH) defines a
protocol for publishing and harvesting _metadata records_.  It is
independent of the format used to represent the _metadata records_,
and supports representations in multiple formats. The protocol allows
servers to publish metadata records and clients to harvest the
metadata records and changes to the metadata records.  The protocol is
based on Atom 1.0 and archived feeds. It is stateless and follows
RESTful principles.

Atom-PMH uses Atom Feed Documents to publish Atom entries representing
the metadata records and changes to those metadata records. The Atom
entries contain one or more links to representations of the metadata
record. Clients can retrieve all the metadata record by retrieving all
the Atom entries and following those links.

The entire feed can be broken up into a chain of multiple Atom Feed
Documents. This allows support for large and/or changing feeds. The
Atom Feed Documents are ordered by time, so clients can harvest
changes to the feed without need to retrieve the entire feed. An
updated metadata record appears as a newer Atom entry in the feed, and
a deletion Atom entry is used to indicate a metadata record has been
deleted. Clients can detect changes by retrieving and processing Atom
Feed Documents until an Atom Feed Document older than their previous
harvest is encountered.

A variant of the protocol is defined to support servers that do not
keep track of deleted metadata records. In a "complete feed," the
entire feed represents all the currently available metadata records.
In a complete feed, deletion Atom entries are not used to indicate
deleted metadata records. Clients can detect deleted metadata records
by their absence from the complete feed.

Introduction
------------

### General introduction

The Atom Feed Protocol for Metadata Harvesting (Atom-PMH) is a
mechanism for a _producer_ to communicate to _consumers_ the set of
_metadata records_ it has. Changes to that set (additions,
modifications and deletions) are also communicated.

The _provider_ produces a set of _Atom Feed Documents_ linked together
as an _archive feed_. There is a _subscription document_ which
contains the most recent _entries_, followed by zero or more _archive
documents_. The _Atom Feed Documents_ are in reverse chronological
order from the newest to the oldest. The set of _entries_ from all the
_Atom Feed Documents_ makes up the _logical feed_.

When a new _metadata record_ is created, an _entry_ is added to the
_logical feed_. When a _metadata record_ is modified, a new _entry_ is
added to the _logical feed_. When a _metadata record_ is deleted a
special _deletion entry_ is added to the _logical feed_. With
modifications and deletions, the previous entries can either be kept
or removed from the _logical feed_, since the _consumer_ knows to ignore
them because they have an older timestamp than the newer _entry_.

Consumers start with the _subscription document_ and process the
_entries_ in it, then continuing with the previous _archive
document_. Since the _Atom Feed Documents_ are in reverse
chronological order, the _consumer_ can stop processing _entries_ when
it reaches a timestamp that it has previously processed. This allows
_consumers_ to efficiently harvest changes.

The creation and update _entries_ contain one or more alternate links
to representations of the _metadata record_. The special _deletion
entry_ is an _entry_ that contains no alternate links (but has an
empty `atom:content` element to satisfy the rules of Atom 1.0.)

#### General examples

##### Entries

This is an example of an _Atom Feed Document_ representing two
_metadata records_.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom">
      <updated>2012-11-01T14:00:00Z</updated>
      <id>urn:uuid:953d1150-ff9a-41c0-975b-d1fbe17c3dd8</id>
      <title>Basic example</title>

      <entry>
        <title>Test 1</title>
        <id>urn:uuid:0b116a23-9bfc-49b1-97f7-90fb012c60a4</id>
        <updated>2011-12-10T18:30:02Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/t1.atom-rdc"/>
      </entry>
	  
      <entry>
        <title>Test 2</title>
        <id>urn:uuid:24870a63-01ae-4fed-878b-2ec8d498cfd0</id>
        <updated>2011-12-10T15:30:02Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/t2.atom-rdc"/>
      </entry>
    </feed>

In this example, the URI in the two alternate links resolve to an
Atom-RDC _Atom Entry Document_ that represents the _metadata record_.

##### Representing updates and delete

If the second _metadata record_ is modified and the first _metadata
record_ deleted, the new entries are shown in this _Atom Feed
Document_. The `atom:updated` timestamp tells the _consumer_ which
ones to process.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom">
      <updated>2012-11-01T14:00:00Z</updated>
      <id>urn:uuid:953d1150-ff9a-41c0-975b-d1fbe17c3dd8</id>
      <title>Basic example</title>

      <entry>
        <title>Test 1 (deleted)</title>
        <id>urn:uuid:0b116a23-9bfc-49b1-97f7-90fb012c60a4</id>
        <updated>2011-12-10T20:00:00Z</updated>
        <content/>
      </entry>
	  
      <entry>
        <title>Test 2 (modified)</title>
        <id>urn:uuid:24870a63-01ae-4fed-878b-2ec8d498cfd0</id>
        <updated>2011-12-10T20:00:00Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/t2.atom-rdc"/>
      </entry>

      <entry>
        <title>Test 1</title>
        <id>urn:uuid:0b116a23-9bfc-49b1-97f7-90fb012c60a4</id>
        <updated>2011-12-10T18:30:02Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/t1.atom-rdc"/>
      </entry>
	  
      <entry>
        <title>Test 2</title>
        <id>urn:uuid:24870a63-01ae-4fed-878b-2ec8d498cfd0</id>
        <updated>2011-12-10T15:30:02Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/t2.atom-rdc"/>
      </entry>
    </feed>

Alternatively, one/both of the the original _entries_ can be omitted.

##### Archived feeds

When there are many _entries_, the _producer_ can split the _logical
feed_ into multiple _Atom Feed Documents_. These form a linked list,
using the prev-archive link.

For example, the start of the linked list is the _subscription document_:

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom">
      <link rel="prev-archive" href="http://example.org/feed/L99"/>
      <updated>2012-11-01T14:00:00Z</updated>
      ...
	</feed>

The prev-archive link resolves to the following _archive document_:

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom">
      <link rel="prev-archive" href="http://example.org/feed/L98"/>
      <updated>2012-10-31T14:00:00Z</updated>
      ...
	</feed>

The prev-archive link resolves to the following _archive document_:

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom">
      <link rel="prev-archive" href="http://example.org/feed/L97"/>
      <updated>2012-10-30T14:00:00Z</updated>
      ...
	</feed>

And so on, until the oldest _archive document_ which does not
have a prev-archive link.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom">
      <updated>2012-01-01T14:00:00Z</updated>
      ...
	</feed>

### Complete feeds introduction

An alternative method for representing deletions can be used by
_providers_ that do not track deleted _metadata records_. All
_entries_ for that _metadata record_ are simply removed from the
_logical feed_ and the _Atom Feed Document_ is marked as complete with
the `fh:complete` element.

This avoids the need for _deletion entries_. But it requires the
entire _logical feed_ to be entirely represented by a single _Atom
Feed Document_. Therefore, this approach is not recommended when there
are many _entries_.

_Consumers_ processing this _Atom Feed Document_ can detect deleted
_metadata record_ by the absence an _entry_ for it.

#### Example of complete feeds

The previous example showing a deleted _metatdata record_ can be
represented as:

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:fh="http://purl.org/syndication/history/1.0">
      <updated>2012-11-01T14:00:00Z</updated>
      <id>urn:uuid:953d1150-ff9a-41c0-975b-d1fbe17c3dd8</id>
      <title>Alternate delete example</title>
	  
      <fh:complete/>
	  
      <entry>
        <title>Test 2 (modified)</title>
        <id>urn:uuid:24870a63-01ae-4fed-878b-2ec8d498cfd0</id>
        <updated>2011-12-10T20:00:00Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/t2.atom-rdc"/>
      </entry>

      <entry>
        <title>Test 2</title>
        <id>urn:uuid:24870a63-01ae-4fed-878b-2ec8d498cfd0</id>
        <updated>2011-12-10T15:30:02Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/t2.atom-rdc"/>
      </entry>
    </feed>

As before, the original _entry_ for the updated _metadata record_ can
be omitted.


Concepts and terminology
------------------------

### Notational conventions

#### Conformance

The key words **shall**, **shall not**, **should** and **should not**
in this specification are to be interpreted according to [RFC 2119].

[RFC 2119]: <http://tools.ietf.org/html/rfc2119> "Key words for use in RFCs to Indicate Requirement Levels"

#### Namespaces

The following XML namespace prefixes are used in this specification:

atom
: http://www.w3.org/2005/Atom

fh
: http://purl.org/syndication/history/1.0

### Layers of representation

This specification clearly distinguishes between the different layers
of abstraction:

Model
: A conceptual data model that is not tied to any representation.  For
  example, the abstract model of a collection's title.
  
Format
: A mechanism for representation instances of the _model_. There can
  be different _formats_ that represent the same model. For example,
  an instance of the title _model_ can be represented in RIF-CS or
  RDF.

Protocol
: A mechanism for transporting instances of a _format_. For
  example, OAI-PMH is a protocol.

The mapping between these layers is not always one to one. For
example, a single Atom-RDC entry can represent more than one _metadata
record_ when it both contains metadata about a data collection and
the people associated with that data collection.

### Data and metadata

This specification uses the following terms to describe the different
types of _models_:

Subject
: The actual research collection data, person, activity or service.

Metadata record
: Metadata that describes that subject.

Administrative metadata
: Metadata that describes the metadata record. For example, when
  the _metadata record_ was updated.

### Metadata records

The profiles in this specification are based on a model where the
_provider_ has a set (i.e. unordered collection) of zero or more
_metadata records_. This set will be referred to as the **current pool**.

The following events can occur on a _metadata record_:

- A _metadata record_ is added to the _current pool_ when it is created.

- The contents of a _metadata record_ can be changed when it is
  modified.

- A _metadata record_ is removed from the _current pool_ when it is
  deleted.

#### Implementation of modify and/or delete

Some providers might never modify any _metadata records_.

Some _providers_ might never delete any _metadata records_.  Most
implementations that delete _metadata records_ will keep track of
them, but some basic implementations do not.  Implementations that do
not track deleted _metadata records_ cannot distinguish between a
record that had never been created vs one that was created and then
deleted.

It is recommended that _providers_ track deleted _metadata records_.
This specification supports both types of implementation, but is only
scalable when deletions are tracked (or deletions never occur).

A _metadata record_ is considered deleted when all of its
representations are no longer available. But it is up to the
_consumer_ to decide how to interpret when some, but not all, of the
representations are no longer available. This is discussed in
_Processing deleted formats_.

#### Identification of metadata records

Every _metadata record_ is associated with a value that is a unique
identifier for the purposes of this specification. An "identifier"
means one value corresponds to no more than one _metadata record_. As
a "unique identifier," no other value (of this type) can correspond
with that same _metadata record_. There can be other types of
identifers associated with the _metadata record_ (both non-unique
identifiers and unique identifiers), but they will not be discussed in
this specification. When this specification uses the term
**identifier** it is always referring to this particular unique
identifier.

#### Last modified time

A **last modified time** is associated with every _metadata record_
and is the time of the most recent creation, modification or deletion
event that occured on the _metadata record_.

### Atom 1.0

_Atom 1.0_ is defined in RFC 4287 _The Atom Syndication Format_
[RFC 4287]. It defines two models:

- **Logical feed** is a model composed of _feed metadata_ and zero or
  more _entries_.  The term _logical feed_ comes from RFC 5005, which
  introduces the concept of splitting up a _logical feed_ that RFC
  4287 did not have.

- **Entry** is a model composed of _entry metadata_ and optional _entry
  content_.

[RFC 4287]: <http://tools.ietf.org/html/rfc4287> "The Atom Syndication Format"

The following terms are not used in RFC 4287, but also have been
introduced in this specification for clarity.

- **Feed metadata** is a model of the metadata that describes the
    _logical feed_.

- **Entry metadata** is a model of the metadata that describes the
    _entry_.

- **Entry content** refers to the actual data of the _entry_. It is
    represented by the `atom:content` element and/or referenced as by
    a URI in the `alternate` link(s) in the _entry metadata_.

The RFC 4287 defines two XML vocabularies:

- The **Atom Feed Document** is a format to represent _feed metadata_
  and (the complete set or a subset of) _entries_ from the _logical
  feed_. It is an XML document whose root element is the `atom:feed`
  element.

- The **Atom Entry Document** is a format to represent a single _entry_.
  It is an XML document whose root element is the `atom:entry`
  element.

In this specification, the term **alternative link** refers to an
`atom:link` element whose link relationship type (as indicated by the
absence of a `rel` attribute or its presence and value) is
`alternate`. The term **self link** refers to an `atom:link` element
whose link relationship type (as indicated the value of the `rel`
attribute) is `self`. Other types of links are described in the same
way.

### Complete vs archive feeds

A **complete feed** is when the entire _logical feed_ is entirely
represented by a single _Atom Feed Document_.

An **archived feed** is when the entire _logical feed_ is entirely
represented by a set of one or more linked _Atom Feed Documents_ as
defined by [RFC 5005] _Feed Paging and Archiving_.

With _archived feeds_ there is always one _subscription document_ and
zero or more _archive documents_. The **subscription document**
contains the latest entries and is the starting point for following
the chain consisting of all the _Atom Feed Documents_ making up the
_archived feed_. The **archive documents** contain older entries.

The terms introduced in this section are defined by RFC 5005. The
"paged feeds" defined by RFC 5005, are not used in this
specification. This specification avoids the term "pages" to ensure
that it is clear that it is always referring to _archived feeds_.

Do not confuse _archived feeds_ with _paged feeds_. It is particularly
confusing because the prev-archive links in _archived feeds_ performs
a similar function to next links in _paged feeds_; and next-archive
links are similar to prev links. The prev links and next links are not
prohibited by this specification; they are simply not used because
_paged feeds_ are not used.

[RFC 5005]: <http://tools.ietf.org/html/rfc5005> "Feed Paging and Archiving"

### Example metadata format: Atom-RDC

Atom-RDC is a format for representing _metadata records_. It is
specified by [Atom-RDC-spec] and also available on [Atom-RDC-Dataspace].

It uses an Atom entry to represent the _metadata records_.  That Atom
entry contains Atom elements and non-atom elements to represent the
data elements of the _metadata record_. The Atom elements are used
when it was appropriate to map the data element into the Atom
elements. The non-Atom elements were introduced when such mappings
were not appropriate.

This specification treats Atom-RDC as just another format for
representing _metadata records_.

If Atom-RDC is being used with this protocol, there are two different
types of Atom _entries_ being used. The Atom-RDC _entries_ correspond
to the _metadata records_ and the _entries_ in this protocol
correspond to _administrative metadata_ for those _metadata records_.

[Atom-RDC-spec]: <http://uq-eresearch-spec.github.com/atom-rdc> "Atom representation of Research Data Context"

[Atom-RDC-Dataspace]: <http://dataspace.uq.edu.au/doc/atom> "Atom representation of Research Data Context"

### Roles

This specification defines requirement on the following roles:

Producer
: Deployment of software that makes the _current pool_ of _metadata
  records_ available using the mechanisms defined in this
  specification.

Consumer
: Deployment of software that obtains the _current pool_ of _metadata
  records_ from a _producer_ using the mechanisms defined in this
  specification.

The protocol defined in this specification is designed to allow the
contents of the _current pool_, and the events that subsequently occur
on it, to be communicated from a _provider_ to a _consumer_.

Protocol details
----------------

### Overview

This specification defines the use of these mechanisms:

- Using a single _logical feed_ as a _model_ of the _current pool_.

- _Atom Feed Documents_ as a _format_ for representing the _logical
  feed_ and changes to that _logical feed_.

The delivery of those _Atom Feed Documents_ from the _provider_ to the
_consumer_ is out of scope for this specification. But typically they
will be delivered over HTTP/HTTPS.

### Logical feed

Every _entry_ in the _logical feed_ **shall** correspond with exactly
one _metadata record_.

This _metadata record_ could be in the _current pool_ or a deleted
_metadata record_ that is not in the _current pool_.

### Atom Feed Documents

Producers **shall** provide a set of one or more _Atom Feed Documents_
that represents the _logical feed_.

These _Atom Feed Document(s)_ **shall** conform to RFC 4287 [RFC 4287].

These _Atom Feed Document(s)_ **shall** conform to an _archived feed_
as defined by [RFC 5005].

### Timestamps

Every _Atom Feed Document_ **shall** have an updated timestamp later
than or equal to the updated timestamp of every _entry_ contained in
it.

In all _Atom Feed Documents_ with a prev-archive link (referrer), the
prev-archive link **shall** resolve to an _Atom Feed Document_ (referee).

The referee _Atom Feed Document_ **shall** have an updated timestamp
that is earlier than or equal to the timestamp of every entry in the
referrer _Atom Feed Document_.

These requirements define an ordering of the _Atom Feed Documents_,
but the individual _entries_ within each _Atom Feed Document_ can
appear in any order.

### Types of entries

The _entries_ in the _logical feed_ can be classified according to
their purpose:

- Active entries represent the value of a _metadata entry_ currently
  in the _current pool_.
- Historical entries represent the value of a _metadata entry_ that
  has been modified and/or deleted. These are the result of an
  implementation not removing previously _active entries_ when the
  _metadata record_ is modified or deleted, which is permitted by
  this specification.
- Deletion entries represent the deletion of a _metadata record_.

The _entries_ in the _logical feed_ function as _administrative
metadata_. The _entries_ do not represent the actual _metadata
records_. The _active entries_ contain a link to a representation of
the _metadata record_.

#### Active entries

Every _metadata record_ in the _current pool_ **shall** correspond
with exactly one _active entry_ in the _logical feed_.

The _logical feed_ **shall not** have any _active entries_ that do not
correspond to any _metadata record_ in the _current pool_.

The _active entries_ needs to satisfy all of the following:

- The value of the `atom:id` element in the _active entry_ **shall**
  be the _identifier_ for the _metadata record_.

- The value of the `atom:updated` element in the _active entry_ **shall** 
  be the _last modified time_ of the _metadata record_.

- The value of the `atom:updated` element in the _active entry_ **shall not** 
  be earlier than any _historical entry_ for the _metadata record_.

- The value of the `atom:updated` element in the _active entry_ **should not** 
  be the same as any _historical entry_ for the _metadata record_.

- The _active entry_ **shall not** contain an `atom:content` element.

- The _active entry_ **shall** contain at least one `atom:link` element that
  satisfies all of these criteria:
    - the link relationship type is `alternate`;
	- the URI value resolves to a representation of the _metadata
      record_; and
    - the link type is an Internet Media Type of the _metadata
	  record's_ representation format.

- The _active entry_ **shall not** contain any `atom:link` element
  of link relationship type `alternate` and the URI value
  does not resolve to a representation of the _metadata record_.

RFC 4287 mandates there to be exactly one `atom:id`, exactly one
`atom:updated` and exactly one `atom:title` element in in every
_entry_. The _entry_ may contain other elements, but these are not
used by these profiles.

Atom 1.0 specifies that the link relationship type must be treated as
`alternate` if the `rel` attribute is not present. Therefore, the
`atom:link` element must either: have no `rel` attribute, or a `rel`
attribute with a value of `alternate`.

No requirements are placed on the value of the mandatory `atom:title`
element.  It is suggested that a copy of an appropriate value from the
_metadata record_ be used to aid debugging. For example, the title
from a collection record, or the person's name from a party
record.

#### Deletion entries

Deletion entries represent the deletion of a _metadata record_. That
is, when it is removed from the _current pool_.

The _provider_ **shall** treat every _metadata record_ removed from
the _current pool_ in the same manner; satisfying at least one of the
following deletion options for every deletion of a _metadata record_:

- Add exactly one _deletion entry_ corresponding to the deletion event
  to the _logical feed_; or
- Remove all _historical records_ corresponding to the _metadata
  record_ from the _logical feed_.

The  first deletion  option is  preferred, because  it  simplifies how
_consumers_  incrementally  detect  deletions  and  will  not  require
modification of any _archive documents_. The second deletion option is
useful for _providers_ that do not track deleted _metadata records_.

If using the first deletion option, the _provider_ **should not**
include a `fh:comlete` element in any of the _Atom Feed Document(s)_.

If using the second deletion option, the _provider_ **shall** ensure
the _subscription document_ contains all the _active entries_ and no
_historical entries_ corresponding to any deleted _metadata records_
from the _logical feed_, and it **shall** include a `fh:complete`
element in the _subscription document_.

See _Complete Feeds_ for addition requirements relating to the use
of the `fh:complete` element.  The second deletion option is not
preferred, because it prohibits the use of _archive pages_ and
therefore can be inefficient when there are many _metadata records_.

If used, the _deletion entries_ needs to satisfy all of the following:

- The value of the `atom:id` element in the _deletion entry_ **shall**
  be the _identifier_ for the deleted _metadata record_.

- The value of the `atom:updated` element in the _deletion entry_
  **shall** be the _last modified time_ of the _metadata record_.

- The value of the `atom:updated` element in the _deletion entry_
  **shall not** be earlier than any _historical entry_ for the
  _metadata record_.

- The value of the `atom:updated` element in the _deletion entry_
  **should not** be the same as any _historical entry_ for the
  _metadata record_.

- The _active entry_ **shall not** contain any `atom:link` element that
  has a link relationship type of `alternate` (either with or without
  an explicit `ref` attribute).

- The _deletion entry_ **shall** contain an `atom:content` element
  that has no `src` attribute and no content.

#### Historical entries

Historical entries represent the value of a _metadata entry_ that
has been modified and/or deleted.

Implementations can choose whether to include historical entries in
their _logical feed_ or not. If a _metadata record_ is deleted, the
impelementation can either remove the old _active entry_ and replace
it with a new _active entry_; or keep the old _active entry_ as a
_historical entry_ and add a new _active entry_. Similarly, for when a
_metadata record_ is modified.

Every modification or deletion of a _metadata record_ **should**
correspond with exactly one _historical entry_ in the _logical feed_.
In this section, the _active entry_ for that _metadata record_
immediately before the event will be referred to as the _old entry_.

The _historical entries_ needs to satisfy all of the following:

- The value of the `atom:id` element in the _historical entry_ **shall**
  be the _identifier_ for the _metadata record_.

- The value of the `atom:updated` element in the _historical entry_ **shall** 
  be same as the value of the `atom:updated` entry in the _old entry_.

- The _historical entry_ **shall not** contain an `atom:content` element.

- The _historical entry_ **shall** contain at least one
  `atom:link` element that has a link relationship type of `alternate`
  (either with or without an explicit `ref` attribute).

There are no formal requirements on the URI of the alternate link(s).
If a _metadata record_ is modified, the URI might resolve to a
representation of the _metadata record_ before it was modified or
after modification. If a _metadata record_ is deleted, the URI might
resolve to representation of the _metadata record_ before it was
deleted or is unresolvable.

### Complete feeds

If an _Atom Feed Document_ contains all the _active entries_ and no
_historical entries_ corresponding to any deleted _metadata records_
from the _logical feed_, and it **should** include a `fh:complete`
element.

If an _Atom Feed Document_ does not contain all the _active entries_
from the _logical feed_, or contains _historical entries_ without
corresponding _deleted entries_ or _active entries_ for that _metadata
record_, it **shall not** include a `fh:complete` element.

The `fh:complete` element is defined in RFC 5005. Typically, it can be
only be used when there is only one _Atom Feed Document_ (i.e. only
the _subscription document_ and are no _archive documents_). There are
other situations when it can appear. For example, when the
_subscription document_ is empty and all the _active entries_ are all
in one of the _archive documents_.  An edge case is when the _current
pool_ contains no _metadata records_, since all _Atom Feed Documents_
with no _entries_ or only _deletion entries_ can claim they are
complete, and there can be multiple such _Atom Feed Documents_.

Atom-RDC
--------

For the _active entry_,

- If using Atom-RDC as the representation format, the URI resolves to an
  _Atom Entry Document_ that conforms to Atom-RDC.

- If using Atom-RDC as the representation format, the Internet Media
  Type is `application/atom+xml`.

For the Atom-RDC _Atom Entry Documents_:

- In the Atom-RDC representing the _metadata record_, the self link
  (if present) **shall** be the same URI that is in the _entry metadata_
  alternate link.

Examples
--------

### Example 1: feed with archive documents

In this example, the _producer_ provides four undeleted _metadata
records_. The producer provides four _Atom Feed Documents_ (one
_subscription document_ and three _archive documents_) and one _Atom
Entry Document_ for each _metadata record_.

This is the _subscription document_.

It is suggested that all subscription documents include a current
link, but this is not mandatory. In all subscription documents where
there exists at least one archive document, the prev-archive link is
mandatory. But it will be prohibited when there does not exist any
archive documents.

In this example, the current link resolves to this subscription
document (i.e. itself); and the prev-archive link resolves to the
first archive document.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom">
	  <link rel="current" href="http://example.org/feed/archived"/>
	  <link rel="prev-archive" href="http://example.org/archived/2012/10/31"/>
      <updated>2012-11-01T14:00:00Z</updated>
      <id>urn:uuid:3ce05531-b9c0-4a7d-8966-4d9a9a3a0695</id>
      <title>Example 1</title>

      <entry>
        <title>Alpha data collection</title>
        <id>urn:uuid:177d5415-c443-410f-a5b6-44bf8433594f</id>
        <updated>2012-11-01T07:00:00Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/0001"/>
      </entry>
    
    </feed>

This is the first _archive document_.

It is suggested that all most-recent archive document include a
current link and the `fh:archive` element; but none of these are
mandatory.  In all most-recent archive documents when there are more
than one _archive documents_, the prev-archive link is always
mandatory; but if there is only one archive document, the prev-archive
link is prohibited.. There is no next-archive link, because this is
the most recent complete archive; although another archive may be
under construction, it would be an error to link to it before
completion.

In this example, the current link resolves to the subscription
document; and the prev-archive link resolves to the second archive
document.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
	      xmlns:fh="http://purl.org/syndication/history/1.0">
	  <link rel="current" href="http://example.org/archived"/>
	  <link rel="self" href="http://example.org/feed/archived"/2012/10/31"/>
	  <link rel="prev-archive" href="http://example.org/archived/2012/06/30"/>
      <updated>2012-10-31T14:00:00Z</updated>
      <id>urn:uuid:3ce05531-b9c0-4a7d-8966-4d9a9a3a0695</id>
      <title>Example 1</title>
      <fh:archive/>
	  
      <entry>
        <title>Beta data collection</title>
        <id>urn:uuid:e7aca47e-76c5-4648-948b-583ffdaafa0d</id>
        <updated>2012-10-31T12:35:52Z</updated>
        <link type="application/atom+xml" href="http://example.org/entry/0002"/>
      </entry>

    </feed>

This is the second _archive document_.

It is suggested that intermediate archive documents include a
next-archive link, a current link and the `fh:archive` element; but
none of these are mandatory. In every intermediate archive document,
the prev-archive link is mandatory.

In this example, the optional current link resolves to the
subscription document; the optional next-archive link resolves to the
first archive document; and the mandatory prev-archive link resolves
to the third archive document.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
	      xmlns:fh="http://purl.org/syndication/history/1.0">
	  <link rel="current" href="http://example.org/archived"/>
 	  <link rel="next-archive" href="http://example.org/archived/2012/10/31"/>
	  <link rel="self" href="http://example.org/feed/archived"/2012/06/30"/>
 	  <link rel="prev-archive" href="http://example.org/archived/2011/12/31"/>
      <updated>2012-03-30T14:00:00Z</updated>
      <id>urn:uuid:3ce05531-b9c0-4a7d-8966-4d9a9a3a0695</id>
	  <title>Example 1</title>
      <fh:archive/>
	  
      <entry>
        <title>Gamma data collection</title>
        <id>urn:uuid:fca64ec1-4984-4d34-8f02-f14a58ec5e78</id>
        <updated>2012-02-29T14:00:00Z</updated>
        <link type="application/atom+xml" href="http://example.org/entry/0003.atom"/>
        <link type="application/atom+xml" href="http://example.org/entry/0003"/>
      </entry>
      
    </feed>

This is the third and earliest _archive document_.

It is suggested that all earliest archive document include a
next-archive link, and a current link and the `fh:archive` element;
but none of these are mandatory. In every earliest archive document,
the prev-archive link is prohibited.

In this example, the optiona current link resolves to the subscription
document; and the optional next-archive link resolves to the second
archive document.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
	      xmlns:fh="http://purl.org/syndication/history/1.0">
	  <link rel="current" href="http://example.org/archived"/>
 	  <link rel="next-archive" href="http://example.org/archived/2012/06/30"/>
	  <link rel="self" href="http://example.org/feed/archived"/2011/12/31"/>
      <updated>2012-02-29T14:00:00Z</updated>
      <id>urn:uuid:3ce05531-b9c0-4a7d-8966-4d9a9a3a0695</id>
	  <title>Example 1</title>
      <fh:archive/>
	  
      <entry>
        <title>Delta data collection</title>
        <id>urn:uuid:4cee3cd0-a7a7-42c8-a6ee-74df0bd04cc4</id>
        <updated>2011-12-10T18:30:02Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/0004"/>
      </entry>
      
    </feed>

The URI in the entry in the _subscription document_ resolves to this
Atom-RDC conformant _Atom Entry Document_:

    <?xml version="1.0" encoding="utf-8"?>
    <entry xmlns="http://www.w3.org/2005/Atom">
      <id>urn:uuid:177d5415-c443-410f-a5b6-44bf8433594f</id>
      <link rel="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"
	        href="http://purl.org/dc/dcmitype/Collection" title="Collection"/>
      <title type="text">Location and temperature data for estuarine
      crocodiles on Cape York Peninsula measured using acoustic telemetry</title>
      <content type="text">Estuarine crocodile location and
        temperature observations recorded using acoustic telemetry
        since 2007 on Cape York Peninsula, Queensland, Australia. The
        data comes from sensors attached to more than sixty estuarine
        crocodiles. Variables measured include location, depth,
        environmental temperature and body temperature.</content>
      <link rel="http://xmlns.com/foaf/0.1/page" href="http://example.com/index.html?page=39442"/>
      <category label="Zoology"/>
      <category term="Ecology"/>
      <author>
        <name>Dr Hamish Campbell</name>
        <email>hamish.campbell@uq.edu.au</email>
      </author>

      <link rel="self" href="http://example.org/entry/0001">
      <updated>2012-10-30T07:00:00Z</updated>
      <source>
        <author>
          <name>OzTrack System</name>
          <uri>http://oztrack.uq.edu.au</uri>
        </author>
      </source>
    </entry>

The URI in the entries in all the _archive documents_ also resolve
to an Atom-RDC conformant _Atom Entry Document_.

The self links and `fh:archive` elements in the head sections are
shown in this example, but they are optional.

Atom 1.0 allows other elements in the _feed metadata_. These are
optional, but can be included to aid debugging. For example
`atom:generator` and `atom:author`.

### Example 2: delete with deletion entries

In this example, the _producer_ has deleted one of the _metadata
records_ from example 1.

This is the _subscription document_.

It contains a _deletion entry_ for the _metadata record_.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
	      xmlns:fh="http://purl.org/syndication/history/1.0">
	  <link rel="current" href="http://example.org/feed/archived"/>
	  <link rel="prev-archive" href="http://example.org/archived/2012/11/01"/>
      <updated>2012-11-02T14:00:00Z</updated>
      <id>urn:uuid:3ce05531-b9c0-4a7d-8966-4d9a9a3a0695</id>
      <title>Example 2</title>

      <entry>
        <title>Alpha data collection (deletion entry)</title>
        <id>urn:uuid:177d5415-c443-410f-a5b6-44bf8433594f</id>
        <updated>2012-11-01T23:00:00Z</updated>
        <content/>
      </entry>

    </feed>

The prev-archive link resolves to the first _Atom Feed Document_ presented
in example 1. It was previously the _subscription document_ but is
now one of the _archive documents_.

### Example 3: feed with no archive documents

In this example, the _producer_ provides four undeleted _metadata
records_.

There is only the _subscription document_. It is a complete _Atom Feed
Document_ containing alternate links to all four _metadata records_.

This example contains an optional self link and optional `fh:complete`
element in the head section.

The first entry shows an `atom:link` element with an explicit `ref`
attribute.

The second entry shows an `atom:link` element without a `ref`
attribute, since its absence means `alternate`.

The third entry shows that it is possible to have multiple `alternate`
links. This is permitted, since the only requirement is there has to
be at least one of them.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
	      xmlns:fh="http://purl.org/syndication/history/1.0">
      <updated>2012-11-01T14:00:00Z</updated>
      <id>urn:uuid:3ce05531-b9c0-4a7d-8966-4d9a9a3a0695</id>
      <title>Example 2</title>
	  <link rel="self" href="http://example.org/feed/complete/>

      <fh:complete/>
      
      <entry>
        <title>Alpha data collection</title>
        <id>urn:uuid:177d5415-c443-410f-a5b6-44bf8433594f</id>
        <updated>2012-11-01T07:00:00Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/0001"/>
      </entry>
    
      <entry>
        <title>Beta data collection</title>
        <id>urn:uuid:e7aca47e-76c5-4648-948b-583ffdaafa0d</id>
        <updated>2012-10-31T12:35:52Z</updated>
        <link type="application/atom+xml" href="http://example.org/entry/0002"/>
      </entry>

      <entry>
        <title>Gamma data collection</title>
        <id>urn:uuid:fca64ec1-4984-4d34-8f02-f14a58ec5e78</id>
        <updated>2012-02-29T14:30:00Z</updated>
        <link type="application/atom+xml" href="http://example.org/entry/0003"/>
        <link type="application/atom+xml" href="http://example.org/entry/0003.atom"/>
      </entry>

      <entry>
        <title>Delta data collection</title>
        <id>urn:uuid:4cee3cd0-a7a7-42c8-a6ee-74df0bd04cc4</id>
        <updated>2011-12-10T18:30:02Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/0004.atom"/>
        <link rel="alternate" type="application/rifcs+xml" href="http://example.org/entry/0004.rifcs"/>
        <link rel="alternate" type="application/rdf+xml" href="http://example.org/entry/0004.rdf"/>
        <link rel="alternate" type="application/xhtml+xml" href="http://example.org/entry/0004.html"/>
      </entry>

    </feed>

The URI in the first entry resolves to the same Atom-RDC conformant
_Atom Entry Document_ that was presented in the example of Profile 1.

The "application/atom+xml" typed URI in the other entries also resolve
to an Atom-RDC conformant _Atom Entry Document_.

### Example 4: delete without deletion records

In this example, the _producer_ has deleted one of the _metadata
records_ from example 2.

Instead of creating _deletion entries_ this example uses the option of
removing all _historical entries_, this option is possible
because it has one complete _Atom Feed Document_.

The `fh:complete` element in the head section is mandatory, because
_deletion entries_ are not being used.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
	      xmlns:fh="http://purl.org/syndication/history/1.0">
      <updated>2012-11-01T14:00:00Z</updated>
      <id>urn:uuid:3ce05531-b9c0-4a7d-8966-4d9a9a3a0695</id>
      <title>Example 4</title>
	  <link rel="self" href="http://example.org/feed/complete/>

      <fh:complete/>
      
      <entry>
        <title>Beta data collection</title>
        <id>urn:uuid:e7aca47e-76c5-4648-948b-583ffdaafa0d</id>
        <updated>2012-10-31T12:35:52Z</updated>
        <link type="application/atom+xml" href="http://example.org/entry/0002"/>
      </entry>

      <entry>
        <title>Gamma data collection</title>
        <id>urn:uuid:fca64ec1-4984-4d34-8f02-f14a58ec5e78</id>
        <updated>2012-02-29T14:30:00Z</updated>
        <link type="application/atom+xml" href="http://example.org/entry/0003"/>
        <link type="application/atom+xml" href="http://example.org/entry/0003.atom"/>
      </entry>

      <entry>
        <title>Delta data collection</title>
        <id>urn:uuid:4cee3cd0-a7a7-42c8-a6ee-74df0bd04cc4</id>
        <updated>2011-12-10T18:30:02Z</updated>
        <link rel="alternate" type="application/atom+xml" href="http://example.org/entry/0004.atom"/>
        <link rel="alternate" type="application/rifcs+xml" href="http://example.org/entry/0004.rifcs"/>
        <link rel="alternate" type="application/rdf+xml" href="http://example.org/entry/0004.rdf"/>
        <link rel="alternate" type="application/xhtml+xml" href="http://example.org/entry/0004.html"/>
      </entry>

    </feed>

### Example 5: update

In this example, the _producer_ has a _metadata records_ that has been
modified.

The first entry is the _historical entry_ and the second entry is the
new _active entry_. They both have the same `atom:id` because they
both correspond to the same _metadata entry_. The _entry_ with the
latest `atom:updated` timestamp is the _active entry_ and the other
_entry_ is the _historical entry_.

    <?xml version="1.0" encoding="utf-8"?>
    <feed xmlns="http://www.w3.org/2005/Atom"
	      xmlns:fh="http://purl.org/syndication/history/1.0">
      <updated>2012-11-01T14:00:00Z</updated>
      <id>urn:uuid:3ce05531-b9c0-4a7d-8966-4d9a9a3a0695</id>
      <title>Example 5</title>

      <entry>
        <title>Beta data collection</title>
        <id>urn:uuid:e7aca47e-76c5-4648-948b-583ffdaafa0d</id>
        <updated>2012-10-31T12:35:52Z</updated>
        <link type="application/atom+xml" href="http://example.org/entry/0002"/>
      </entry>

      <entry>
        <title>Beta data collection</title>
        <id>urn:uuid:e7aca47e-76c5-4648-948b-583ffdaafa0d</id>
        <updated>2012-11-02T07:30:00Z</updated>
        <link type="application/atom+xml" href="http://example.org/entry/0002"/>
      </entry>

    </feed>

It is not mandatory to keep the _historical entry_, so this example is
equally valid if it did not include the first _entry_.

Implementation notes
--------------------

### Detecting entry type

Consumers can detect which type of _entry_ appears in an _Atom Feed
Document_ using the following approach:

- If the _entry_ has no alternate links and an empty `atom:content`
  element without a `src` attribute, it is a _deletion entry_.
  
- If the _entry_ has at least one alternate link and no `atom:content`
  element, it is either an _active entry_ or a _historical entry_.
  
    - If it is the only _entry_ for that _metadata record_ in the
      _logical feed_ or the one with the most latest timestamp, then
      it is the _active entry_.

    - If there are other _entries_ for that _metadata record_ in the
      _logical feed_ with later timestamps, then it is a _historical
      entry_.

Other types of entries are not defined by this specification.

### Detecting deleted _metadata records_

If the _consumer_ obtains an _Atom Feed Document_ with the
`fh:complete` element, it can detect that any _metadata records_ that
it has previously retrieved have been deleted if there are no _active
entries_ for it in that complete _Atom Feed Document_. In this
situation, it cannot rely on _deletion entries_, because the
_producer_ might be using the second deletion option.

If the _consumer_ obtains an _Atom Feed Document_ without the
`fh:complete` element, it can rely on _deletion entries_ to detect
deleted _metadata records_. It only needs to retrieve recent _Atom
Feed Documents_, up to and including the time of its previously
retrieved _Atom Feed Document_, to detect all the deleted _metadata
records_ -- it does not have to retrieve the entire _logical feed_. In
this situation, the _producer_ is definitely not using the second
deletion option.

### Processing deleted formats

A _metadata record_ can be represented by one or more formats, each
represented by a different alternate link. It is possible for a
modification to add or remove different formats.

The _consumer_ can choose how to process a modification where all of
the formats it needs are removed. Most _consumers_ would treat this
the same as the deletion of the _metadata record_.

### Resolvability of URIs

The only mandatory requirement for URIs to be resolvable is with the
URI in _active entries_.

Therefore, if a URI fails to resolve the _consumer_ can deduce the
_entry_ is no longer an _active entry_. It can assume _metadata
record_ has been deleted or modified. This can occur when processing
an _entry_ for a _metadata record_ that was deleted after the _Atom
Feed Document_ was obtained by the _consumer_.

A _consumer_ needs to take into account delivery protocol semantics
when determining if a URI is resolvable or not. For example, when
using HTTP/HTTPS a response code of 404 (forbidden), 404 (not found)
or 410 (gone) can be interpreted as a non-resolvable URI. But a
response code of 401 (unauthorised) or 500 (internal server error)
might not be.

### Changing archive documents and URI

It is not mandatory for the contents of the _archive documents_ to
never change, nor their published URI not to change. This is because
those requirements are defined as _should_ instead of _must_ in RFC
5005. This specification does not change those requirements.

Consumers cannot rely on the contents of the _archive documents_ to
never change. They can also not rely on the URI that resolves to those
_archive documents_ not to change.

### Size of Atom Feed Documents

There are no requirements about the number of entries in each _Atom
Feed Document_. Therefore, an implementation is able to adjust the
number as necesssary: from having one _entry_ per document to having a
single document with all the _entries_. Typically, the _Atom Feed
Documents_ split up the _logical feed_ according to fixed time
periods, which leads to a variable number of _entries_ depending on
how many updates occured in a given period.

Acknowledgements
----------------

This specification was produced by a project supported by the
Australian National Data Service
([ANDS](http://www.ands.org.au/)). ANDS is supported by the Australian
Government through the National Collaborative Research Infrastructure
Strategy Program and the Education Investment Fund (EIF) Super Science
Initiative.
